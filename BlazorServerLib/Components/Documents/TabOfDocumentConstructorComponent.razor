@using MudBlazor

@inherits TTabOfDocumenBaseComponent

<MudCard>
    <MudCardContent id="@($"tab:{ID}")">
        <CascadingValue Value="this">
            @{
                int i = -1;
            }
            @foreach (FormFitModel form_metadata in TabMetadata.Forms)
            {
                i++;

                if (TabOfDocument.JoinsForms?.Count != TabMetadata.Forms.Length)
                    throw new Exception();

                TabJoinDocumentSchemeConstructorModelDB join = TabOfDocument.JoinsForms![i];

                FormConstructorModelDB form_c = join.Form!;
                List<ValueDataForSessionOfDocumentModelDB> _sv = SessionValues is null ? [] : [.. SessionValues.Where(x => x.TabJoinDocumentSchemeId == TabOfDocument.Id && x.TabJoinDocumentScheme!.FormId == form_c.Id)];

                <CascadingValue Value="join">
                    <CascadingValue Value="TabMetadata">
                        <CascadingValue Value="FormsStack">
                            <CascadingValue Value="form_metadata">
                                <CascadingValue Value="form_c">
                                    <CascadingValue Value="_sv">
                                        <CascadingValue Value="FormChangeEvent">
                                            <CascadingValue Value="TabOfDocument">
                                                <MudPaper>
                                                    @if (form_metadata.IsTable)
                                                    {
                                                        <TableFormOfTabConstructorComponent DocumentKey="DocumentKey" ID="@($"[teble]{ID}>{form_metadata.SystemName}")" />
                                                    }
                                                    else
                                                    {
                                                        <FormOfTabConstructorComponent DocumentKey="DocumentKey" ID="@($"{ID}>{form_metadata.SystemName}")" />
                                                    }
                                                </MudPaper>
                                            </CascadingValue>
                                        </CascadingValue>
                                    </CascadingValue>
                                </CascadingValue>
                            </CascadingValue>
                        </CascadingValue>
                    </CascadingValue>
                </CascadingValue>
            }
        </CascadingValue>
    </MudCardContent>
</MudCard>