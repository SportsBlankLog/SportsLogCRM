@using BlazorWebLib.Components.Helpdesk
@using MudBlazor

@inherits BlazorBusyComponentBaseModel

@rendermode @(new InteractiveServerRenderMode(prerender: false))

@if (IsBusyProgress)
{
    <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="my-3" />
}

<MudTreeView Style="width: 100%" ServerData="@LoadServerData" Items="@InitialTreeItems" Hover Dense SelectionMode="@(SelectedValuesChanged is null ? SelectionMode.ToggleSelection: SelectionMode.MultiSelection)" T="RootKLADRModelDB" SelectedValuesChanged="SelectedValuesChangeHandler">
    <ItemTemplate Context="item">
        <MudTreeViewItem @key="@($"node-kladr-{item.Value?.Id}")" Text="@item.Text" Icon="@item.Icon" IconExpanded="@Icons.Custom.Uncategorized.FolderOpen" Value="item.Value" Items="item.Children?.ToList()" CanExpand="item.Expandable" Selected="item.Selected">
            <BodyContent>
                <CascadingValue Value="ReloadNodeAction">
                    <CascadingValue Value="ItemUpdAction">
                        <CascadingValue Value="(TreeItemDataKladrModel)item">
                            <KladrNodeComponent ContextName="@ContextName" />
                        </CascadingValue>
                    </CascadingValue>
                </CascadingValue>
            </BodyContent>
        </MudTreeViewItem>
    </ItemTemplate>
</MudTreeView>