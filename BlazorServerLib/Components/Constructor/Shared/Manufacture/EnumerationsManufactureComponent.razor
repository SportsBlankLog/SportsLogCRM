@inherits BlazorBusyComponentBaseModel

<div class="card">
    <div class="card-body">
        <h5 class="card-title">Справочники</h5>
        <h6 class="card-subtitle mb-2 text-body-secondary">перечисления/списки</h6>

        <MudTreeView @ref="TreeView_ref" Items="@TreeItems" Hover="true">
            <ItemTemplate Context="item">
                <MudTreeViewItem Items="@item.Children" Icon="@item.Icon" IconColor="@(item.Icon!.Equals(icon_directory) ? Color.Default : Color.Info)">
                    <BodyContent>
                        <SystemNameManufactureComponent Item="item" />
                    </BodyContent>
                </MudTreeViewItem>
            </ItemTemplate>
        </MudTreeView>
    </div>
</div>

@code {
    [CascadingParameter, EditorRequired]
    public required ManufactureComponent ManufactureParentView { get; set; }

    [CascadingParameter, EditorRequired]
    public required SystemNameEntryModel[] SystemNamesManufacture { get; set; }

    List<TreeItemData<EntryTagModel>> TreeItems { get; set; } = [];

    const string icon_directory = Icons.Custom.Uncategorized.Folder;
    const string icon_element = Icons.Material.Filled.Label;

    const string type_name_directory = nameof(DirectoryConstructorModelDB);
    const string type_name_element_of_directory = nameof(ElementOfDirectoryConstructorModelDB);

    MudTreeView<EntryTagModel>? TreeView_ref;

    protected override void OnInitialized()
    {
        ManufactureParentView
        .CurrentProject
        .Directories!.ForEach(x =>
        {
            TreeItems.Add(new TreeItemDataModel(new EntryTagModel() { Name = x.Name, Id = x.Id, Tag = type_name_directory }, icon_directory)
                {
                    Qualification = type_name_directory,
                    Children = [.. x.Elements!.Select(y => new TreeItemDataModel(new EntryTagModel() { Id = y.Id, Name = y.Name, Tag = $"{type_name_directory}#{x.Id} {type_name_element_of_directory}" }, icon_element) { Qualification = type_name_element_of_directory })]
                });
        });
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (TreeView_ref is not null && firstRender)
            await TreeView_ref.ExpandAllAsync();
    }
}
